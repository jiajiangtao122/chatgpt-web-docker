import{w as V}from"./@vue_runtime-dom@3.2.47-1f3621cd.js";import{g as ee}from"./slide-verify-code@1.0.0-02750b17.js";import{a as p}from"./index-93d2c664.js";import{u as se,a as ae,j as oe,s as $,k as te,l as le,m as re,i as ne}from"./index-21c5a4bc.js";import{f as ue,I as ie,h,k as S,m as ce}from"./naive-ui@2.34.3_vue@3.2.47-b44668a5.js";import{v as de}from"./uuid@9.0.0-a960c1f4.js";import{d as D,f as C,j as ve,R as fe,E as y,K as U,b as n,L as f,k as w,H as t,F as E,G as F,O as me}from"./@vue_runtime-core@3.2.47-d9a89b1b.js";import{r as l,u as o,a as pe}from"./@vue_reactivity@3.2.47-41cada1d.js";import{J as j}from"./@vue_shared@3.2.47-1870027e.js";import"./@iconify_vue@4.1.0_vue@3.2.47-cce582b6.js";import"./pinia@2.0.33_typescript@4.9.5_vue@3.2.47-5b8e256c.js";import"./vue-demi@0.14.0_vue@3.2.47-71ba0ef2.js";import"./crypto-js@4.1.1-5d2574b3.js";import"./@traptitech_markdown-it-katex@3.6.0-183244bb.js";import"./katex@0.16.4-d49885c5.js";import"./vue-router@4.1.6_vue@3.2.47-becc39a8.js";import"./axios@1.3.4-aba6f0e0.js";import"./@vueuse_core@9.13.0_vue@3.2.47-ded97bfc.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-31ba0d1d.js";import"./vue-i18n@9.2.2_vue@3.2.47-f2ff64de.js";import"./@intlify_shared@9.2.2-6f62a0ce.js";import"./@intlify_core-base@9.2.2-e46b7bcb.js";import"./@intlify_message-compiler@9.2.2-e451351e.js";import"./@intlify_devtools-if@9.2.2-c61c979f.js";import"./vooks@0.2.12_vue@3.2.47-6d2a1cf4.js";import"./evtd@0.2.4-b614532e.js";import"./seemly@0.3.6-5600174a.js";import"./vdirs@0.1.8_vue@3.2.47-4519c5fd.js";import"./treemate@0.3.11-25c27bff.js";import"./vueuc@0.4.51_vue@3.2.47-56f5039e.js";import"./@css-render_vue3-ssr@0.15.12_vue@3.2.47-9765db09.js";import"./@juggle_resize-observer@3.4.0-41516555.js";import"./css-render@0.15.12-57b1a53f.js";import"./@emotion_hash@0.8.0-8a8e73f6.js";import"./lodash-es@4.17.21-cabc0acd.js";import"./date-fns@2.29.3-975a2d8f.js";import"./@css-render_plugin-bem@0.15.12_css-render@0.15.12-9dde7ffe.js";const we={class:"p-4 space-y-5 min-h-[200px]"},_e={class:"space-y-6"},ge={class:"flex items-center space-x-4"},ke={class:"flex-1"},he={class:"flex items-center space-x-4"},ye={class:"flex-1"},be={class:"flex items-center"},Pe={class:"text-center"},xe={class:"flex items-center space-x-2.5 w-full"},Ce={class:"flex-grow"},Re={class:"flex items-center space-x-4"},Se={class:"flex-1"},Ue={class:"flex items-center space-x-4"},Me={class:"flex-1"},Le={class:"flex items-center"},Ne={class:"text-center"},Te=D({__name:"Login",emits:["closeModel"],setup(M,{emit:b}){const P=se(),{isMobile:_}=ae(),u=ue(),c=l(0),d=l(!1),e=l({email:"",firstPassword:"",secondPassword:"",token:"",code:""}),s=l({token:!0,code:!0,submit:!0}),g=l({token:"机器验证"}),L=l(null),N=l(null),z=l(null),R=l(null),A=C(()=>{if(e.value.email.length&&!p(e.value.email))return"error"}),T=C(()=>{if(e.value.firstPassword.length>0&&e.value.firstPassword.length<6)return"error"}),G=C(()=>{if(e.value.secondPassword.length>0&&(e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword))return"error"}),H=()=>{s.value.token===!1?d.value=!0:(d.value=!1,s.value.submit=!0),e.value.token.length&&(s.value.code=!1)},x=()=>{d.value=!1},J=()=>{x(),W(),s.value.token=!0,s.value.code=!1,q(),e.value.token="",g.value.token="重新获取"},O=()=>{x(),s.value.token=!1,s.value.code=!0,s.value.submit=!0,g.value.token="验证失败，请重新验证"},q=()=>{c.value=10,setInterval(()=>{c.value>0&&c.value--,s.value.token=!p(e.value.email)||c.value>0},1e3)},k=()=>{m.value?s.value.submit=!p(e.value.email)||e.value.firstPassword.length<6:(s.value.token=!p(e.value.email)||c.value>0,s.value.submit=!p(e.value.email)||!e.value.code.length||e.value.firstPassword.length<6||e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword)},B=()=>{var v,a;if(m.value?console.log("登录",e.value.email,e.value.firstPassword):console.log("注册",e.value.email,e.value.firstPassword,e.value.secondPassword,e.value.code),!p(e.value.email)){(v=L.value)==null||v.focus();return}if(m.value)console.log("登录",e.value.email,e.value.firstPassword),oe(e.value.email.toLowerCase(),e.value.firstPassword).then(r=>{r.status==="Success"?(b("closeModel"),$(r.data.token),P.getUserInfo(),u.success(r.message)):u.error(r.message)});else{if(console.log("注册/重置密码",e.value.email,e.value.firstPassword,e.value.secondPassword,e.value.code),!e.value.code.length){(a=R.value)==null||a.focus();return}te(e.value.email.toLowerCase(),e.value.code,e.value.firstPassword).then(r=>{r.status==="Success"?(b("closeModel"),$(r.data.token),P.getUserInfo(),u.success(r.message)):u.error(r.message)})}},Q=()=>{e.value.token=de().replace(/-/g,"").toString()},W=async()=>{Q(),await le(e.value.email,e.value.token).then(v=>{var a;v.status==="Success"?((a=R.value)==null||a.focus(),u.success(v.message)):u.error(v.message)})},K=l({website:"",register:""}),I=l(!1);async function X(){try{I.value=!0;const{data:v}=await re();K.value=v}finally{I.value=!1}}ve(()=>{X()});const m=l(!0),Y=()=>{m.value=!0},Z=()=>{m.value=!1};return(v,a)=>{const r=fe("NText");return y(),U("div",we,[n(o(ie),{"show-icon":!1},{default:f(()=>[w(" 首次认证赠送 "+j(K.value.register.freeTimes)+" 次免费提问次数 ",1)]),_:1}),t("div",_e,[t("div",ge,[t("div",ke,[n(o(h),{ref_key:"emailRef",ref:L,value:e.value.email,"onUpdate:value":a[0]||(a[0]=i=>e.value.email=i),status:o(A),clearable:"",placeholder:"请输入登录邮箱",onKeyup:k},null,8,["value","status"])])]),m.value?(y(),U(E,{key:0},[t("div",he,[t("div",ye,[n(o(h),{ref_key:"firstPasswordRef",ref:N,value:e.value.firstPassword,"onUpdate:value":a[1]||(a[1]=i=>e.value.firstPassword=i),status:o(T),clearable:"",type:"password",placeholder:"请输入登录密码",onKeyup:k},null,8,["value","status"])])]),t("div",be,[n(o(S),{disabled:s.value.submit,block:"",type:"success",onClick:B},{default:f(()=>[w(" 登录 ")]),_:1},8,["disabled"])]),t("div",Pe,[n(r,{class:"hyperlink",onClick:V(Z,["prevent"])},{default:f(()=>[w("前往注册/重置密码")]),_:1},8,["onClick"])])],64)):(y(),U(E,{key:1},[t("div",xe,[t("div",Ce,[n(o(h),{ref_key:"codeRef",ref:R,value:e.value.code,"onUpdate:value":a[2]||(a[2]=i=>e.value.code=i),disabled:s.value.code,placeholder:(o(_),"请输入6位验证码"),onKeyup:k},null,8,["value","disabled","placeholder"])]),n(o(S),{class:"flex-shrink-0",disabled:s.value.token,type:d.value?"warning":"primary",onClick:a[3]||(a[3]=i=>d.value?x():H())},{default:f(()=>[w(j(d.value?"取消":`${g.value.token}${c.value>0?`(${c.value}s)`:""}`),1)]),_:1},8,["disabled","type"]),n(o(ee),{show:d.value,onClose:x,onFail:O,onSuccess:J},null,8,["show"])]),t("div",Re,[t("div",Se,[n(o(h),{ref_key:"firstPasswordRef",ref:N,value:e.value.firstPassword,"onUpdate:value":a[4]||(a[4]=i=>e.value.firstPassword=i),status:o(T),clearable:"",type:"password",placeholder:"请输入登录密码 (6位长度以上)",onKeyup:k},null,8,["value","status"])])]),t("div",Ue,[t("div",Me,[n(o(h),{ref_key:"secondPasswordRef",ref:z,value:e.value.secondPassword,"onUpdate:value":a[5]||(a[5]=i=>e.value.secondPassword=i),status:o(G),clearable:"",type:"password",placeholder:"请确认登录密码",onKeyup:k},null,8,["value","status"])])]),t("div",Le,[n(o(S),{disabled:s.value.submit,block:"",type:"success",onClick:B},{default:f(()=>[w(" 注册/重置密码 ")]),_:1},8,["disabled"])]),t("div",Ne,[n(r,{class:"hyperlink",onClick:V(Y,["prevent"])},{default:f(()=>[w("前往登录")]),_:1},8,["onClick"])])],64))])])}}});const Be=ne(Te,[["__scopeId","data-v-09057b16"]]),_s=D({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible"],setup(M,{emit:b}){const P=M,_=l(!1),u=C({get(){return P.visible},set(e){b("update:visible",e)}});function c(){_.value=!0,setTimeout(()=>{_.value=!1},0)}function d(){setTimeout(()=>{u.value=!1},1e3)}return(e,s)=>(y(),F(o(ce),{show:o(u),"onUpdate:show":s[0]||(s[0]=g=>pe(u)?u.value=g:null),"auto-focus":!1,closable:!1,"mask-closable":!1,"close-on-esc":!1,preset:"dialog",title:"用户认证",class:"min-w-[100px]:","z-index":100},{default:f(()=>[_.value?me("",!0):(y(),F(Be,{key:0,onUpdate:c,onCloseModel:d}))]),_:1},8,["show"]))}});export{_s as default};
